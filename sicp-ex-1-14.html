<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
<title>SICP Exercise</title>
<style type="text/css">
  div#bs-console{
    border:1px solid black;
    padding:1em;
    margin-top:1em;
  }
  div#bs-opecode{
    border:1px solid black;
    padding:1em;
    margin-top:1em;
  }
  span.dump_opecode{ color:orange; }
  span.dump_constant{ color:red; }
  div.bs-snippet{
    white-space:pre;
    cursor:pointer;
  }
  textarea{
    font-family:monospace, serif;
  }
  blockquote{
    margin:1rem 0;
    padding:.5rem 1rem .5rem .75rem;
    border-inline-start:.25rem solid #e9ecef;
    border-radius:.25rem
  }
</style>
<script>
MathJax = {
  chtml: {
    matchFontHeight: false
  }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
</head>
<body>

<h1>SICP Exercise 1.14</h1>

<blockquote>
Draw the tree illustrating the process generated by the count-change procedure of Section 1.2.2 in making change for 11 cents. What are the orders of growth of the space and number of steps used by this process as the amount to be changed increases?
</blockquote>

<table><tr><td valign="top">
<textarea id="bs-input" rows="50" cols="150">
(define (p n)
  (define (iter count)
     (if (< count 1)
         (display "")
         (begin (display "    ") (iter (- count 1)))))
  (iter n)

(define (count-change amount) (cc amount 5 1))

(define (cc amount kinds-of-coins depth)
  (p depth)
  (display "(cc ")
  (display amount)
  (display " ")
  (display kinds-of-coins)
  (print ")")
  (cond ((= amount 0) (begin (p depth) (print "=1")) 1)
        ((or (< amount 0) (= kinds-of-coins 0)) (begin (p depth) (print "=0")) 0)
        (else (+ (cc amount (- kinds-of-coins 1) (+ depth 1))
                 (cc (- amount (first-denomination kinds-of-coins)) kinds-of-coins (+ depth 1))))))

(define (first-denomination kinds-of-coins)
  (cond ((= kinds-of-coins 1) 1)
        ((= kinds-of-coins 2) 5)
        ((= kinds-of-coins 3) 10)
        ((= kinds-of-coins 4) 25)
        ((= kinds-of-coins 5) 50)))

(count-change 11)

#|
                                                              a,n
                                                               |
                                  +----------------------------+----------------------------+
                                  |                                                         |
                                a,n-1                                                   a-d(n),n
                                  |                                                         |
                   +--------------+--------------+                           +--------------+--------------+
                   |                             |                           |                             |
                 a,n-2                       a-d(n-1),n-1                 a-d(n),n-1                    a-2d(n),n
                   |                             |                           |                             |
          +-------+-------+             +-------+-------+            +-------+-------+             +-------+-------+
          |               |             |               |            |               |             |               |
        a,n-3        a-d(n-2),n-2    a-d(n-2),n-2   a-2d(n-1),n-1   a-d(n),n-2   a-2d(n),n-1     a-2d(n),n-1     a-3d(n),n
          :               :             :               :            :               :             :               :
  +-------+-------+                                                                                        +-------+-------+
  |               |                                                                                        |               |
a,0             a-1,1                                                                                 a-kd(n),n-1    a-(k+1)d(n),n
                  |
          +-------+-------+
          |               |
        a-1,0           a-2,1
                          |
                  +-------+-------+
                  |               |
                a-2,0           a-3,1
                                  :
                          +-------+-------+
                          |               |
                         1,0             0,1


S(a, n) を (cc a n) が使用する空間サイズとする。
S(a, n) は上記の木の最も深い経路上のノード数になる。
最も深い経路は、
a,n -> a,n-1 -> a,n-2 -> ... -> a,1 -> a,0 -> a-1,0 -> a-2,0 -> ... -> 1.0
である。
a,n -> a,n-1 -> a,n-2 -> ... -> a,1 の経路上のノード数は n
a,0 -> a-1,0 -> a-2,0 -> ... -> 1.0 の経路上のノード数は a
よって、
S(a, n) = a + n
        = Θ(a + n)


T(a, n) を (cc a n) のステップ数とすると、

T(a, n) = (a, n) の1回 +
          (a - d(n), n), (a - 2d(n), n), (a - 3d(n), n) ... (a - (k + 1)*d(n), n) の ⌈a/d(n)⌉ 回 +
          T(a, n - 1) + T(a - d(n), n - 1) + T(a - 2*d(n), n - 1) + ... + T(a - k*d(n), n - 1)
        = 1 +
          ⌈a/d(n)⌉ +
          Σ_{i = 0}^{⌈a/d(n)⌉ − 1} T(a − i*d(n), n − 1)

となる。

たとえば、T(11, 2) は、(11, 2) の1回と、
⌈11/d(2)⌉ = ⌈11/5⌉ = 3 回、つまり、(6, 2) (1, 2) (-4, 2) の 3 回と、
Σ_{i = 0}^{⌈11/5⌉ - 1} T(11 − i*d(2), 1) = T(11, 1) + T(6, 1) + T(1, 1) の合計である。
下図より、
T(11, 1) は 23 回
T(6, 1) は 13 回
T(1, 1) は 3 回

(cc 11 2)
|       \_________________________
|                                 \
(cc 11 1)                        (cc 6 2)
|       \___                      |     \__
|           \                     |        \
(cc 11 0)   (cc 10 1)            (cc 6 1) (cc 1 2)
         __/ |                 __/ |       |     \__
        /    |                /    |       |        \
(cc 10 0)   (cc 9 1)  (cc 6 0)   (cc 5 1) (cc 1 1) (cc -4 2)
         __/ |                 __/ |       |     \__
        /    |                /    |       |        \
(cc 9 0)    (cc 8 1)  (cc 5 0)   (cc 4 1) (cc 1 0) (cc 0 1)
         __/ |                 __/ |
        /    |                /    |
(cc 8 0)    (cc 7 1)  (cc 4 0)   (cc 3 1)
         __/ |                 __/ |
        /    |                /    |
(cc 7 0)    (cc 6 1)  (cc 3 0)   (cc 2 1)
         __/ |                 __/ |
        /    |                /    |
(cc 6 0)    (cc 5 1)  (cc 2 0)   (cc 1 1)
         __/ |                 __/ |
        /    |                /    |
(cc 5 0)    (cc 4 1)  (cc 1 0)   (cc 0 1)
         __/ |
        /    |
(cc 4 0)    (cc 3 1)
         __/ |
        /    |
(cc 3 0)    (cc 2 1)
         __/ |
        /    |
(cc 2 0)    (cc 1 1)
         __/ |
        /    |
(cc 1 0)    (cc 0 1)

よって、
T(11, 2) = 1 + 3 + 23 + 13 + 3 = 43 となる。


T(a, n) = 1 + ⌈a/d(n)⌉ + Σ_{i = 0}^{⌈a/d(n)⌉ − 1} T(a − i*d(n), n − 1)
を式変形して増加オーダー(order of growth)を調べる

T(a, 0) = 1
        = Θ(1)

T(a, 1) = 1 + ⌈a/1⌉ + Σ_{i = 0}^{a - 1} T(a − i, 0)
        = 1 + a + T(a, 0) + T(a - 1, 0) + ... + T(1, 0)
        = 1 + a + 1 + 1 + ... + 1
        = 1 + a + 1*a
        = 2a + 1
        = Θ(a)

T(a, 2) = 1 + a/5 + 1 + Σ_{i = 0}^{a/5} T(a − 5i, 1)
        = 1 + a/5 + 1 + Σ_{i = 0}^{a/5} {2(a − 5i) + 1}
        = 1 + a/5 + 1 + Σ_{i = 0}^{a/5} (2a − 10i + 1)
        = 1 + a/5 + 1 + (2a + 1)(a/5 + 1) - 10Σ_{i = 0}^{a/5}i
        = 1 + a/5 + 1 + (2a + 1)(a/5 + 1) - 10(a/5 + 1)(0 + a/5)/2
        = 1 + a/5 + 1 + (2a + 1)(a/5 + 1) - 5(a/5 + 1)(a/5)
        = 1 + a/5 + 1 + (2a + 1)(a/5 + 1) - (a/5 + 1)a
        = 1 + a/5 + 1 + (a + 1)(a/5 + 1)
        = 1 + (a/5 + 1) + (a + 1)(a/5 + 1)
        = 1 + (a + 2)(a/5 + 1)
        = 1 + (a + 2)(a + 5)/5
        = 1 + (a^2 + 7a + 10)/5
        = (a^2 + 7a)/5 + 3
        = Θ(a^2)

n=3 以上については
T(a, 3) = Θ(a^3)
...
T(a, n) = Θ(a^n)
のようになっている。
|#
</textarea><br>
<div style="float:right;">
<span id="time"></span>
<input type="button" value="eval" onclick="bs_eval()">
</div><br style="clear:both"/>
<div id="bs-console"></div>
<div id="bs-opecode"></div>
</td></tr></table>
<script src="./jquery.js"></script>
<script type="module" src="./biwascheme-0.7.5.js"></script>
<script type="module">
let on_error = function(e) {
  BiwaScheme.Port.current_error.put_string(e.message);
  throw(e);
};
window.bs_eval = function() {
  $("#bs-console").empty();
  $("#bs-opecode").empty();
  let src = $("#bs-input").val();
  let before = new Date();
  let comment = false
  let code = ''
  src.split(/\r?\n/).forEach(function(str, key, arr) {
    code += str + '\n'
    if (!comment && str == '#|') comment = true
    else if (comment && str == '|#') comment = false
    else if (!comment && code.replace(/\r?\n/g, '').length != 0 &&
      (str.replace(/\r?\n/g, '').length == 0 || key == arr.length - 1)) {
      let biwascheme = new BiwaScheme.Interpreter(on_error);
      let vmcode = biwascheme.compile(code);
      let dump = (new BiwaScheme.Dumper()).dump_opc(vmcode.il);
      $("#bs-opecode").append(dump + '<br>');
      biwascheme.evaluate(code, function(result) {
        $("#bs-console").append(result + '<br>');
      })
      code = ''
    }
  });
  let after = new Date();
  $("#time").html("Time: " + (after - before) / 1000 + "sec");
  return false;
}
</script>
</body>
</html>
